
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Refreshrestorepoints    Function  Implied  - RestorePointsManager</title>
   <!-- Bootstrap CSS -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <!-- Bootstrap Icons -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
   <!-- Google Fonts -->
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   <!-- Prism.js for syntax highlighting -->
   <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet">
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.5.0/dist/mermaid.min.js"></script>

   <style>
     body {
       font-family: 'Inter', sans-serif;
       color: #2c3e50;
       background-color: #f8f9fa;
     }
      .sticky-header {
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 4px 20px rgba(0,0,0,.15);
        backdrop-filter: blur(10px);
      }
      .navbar-brand {
        font-weight: 700;
        color: white !important;
        font-size: 1.5rem;
      }

       body { padding-top: 35px; }

      /* Sidebar Styles */
      .sidebar {
        position: fixed;
        padding: 25px 0;
        left: 0;
        width: 330px;
        height: calc(100vh);
        background: #eef2f6;
        border-right: 1px solid #e9ecef;
        overflow-y: auto;
        z-index: 999;
      }
      .sidebar .nav {
        padding: 20px;
        margin: 0; /* Reset any default margin */
      }
        .nav-link {font-size: 1rem; }
      .sidebar .nav-link {
        color: #2c3e50;
        font-weight: 500;
        border-radius: 10px;
        margin-bottom: 5px;
        display: block;
        text-decoration: none;
        white-space: nowrap;
        overflow: hidden;
      }
      .sidebar .nav-link:hover {
        background-color: #667eea;
        color: white;
      }
      .sidebar .nav-link.active {
        background-color: #667eea;
        color: white;
      }
      .sidebar .nav-link i {
        margin-right: 10px;
      }

      .main-content {
        margin-left: 330px;
        padding: 20px;
        position: relative;
        line-height: 1.7;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

       @media (max-width: 768px) {
         .hero-section {
           padding: 40px 20px;
           margin-bottom: 30px;
         }

         .hero-section h1 {
           font-size: 2rem;
         }

         .hero-section p {
           font-size: 1.1rem;
         }

         .sticky-header .navbar-brand {
           font-size: 1.2rem;
         }

         .sidebar {
           width: 100%;
           position: relative;
           height: auto;
           top: 0;
         }

         .main-content {
           margin-left: 0;
         }

         .chapter-card .card-body {
           padding: 20px;
         }

          .nav-buttons {
            bottom: 20px;
            right: 20px;
          }

          .nav-button {
            width: 35px;
            height: 35px;
            font-size: 16px;
          }
       }

      @media (max-width: 576px) {
        .hero-section h1 {
          font-size: 1.8rem;
        }

        .chapter-card {
          margin-bottom: 15px;
        }
      }

     h1, h2, h3, h4, h5, h6 {
       color: #2c3e50;
       font-weight: 600;
       margin-top: 2rem;
       margin-bottom: 1rem;
     }

      h1 {
        font-size: 2.5rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1.5rem;
      }

      p {
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
      }

      .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 10px 0;
        margin-bottom: 40px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,.1);
      }

      .hero-section h1 {
        color: white;
        -webkit-text-fill-color: white;
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .hero-section p {
        font-size: 1.3rem;
        opacity: 0.9;
      }

      .chapter-card {
        background: white;
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,.08);
        /* Removed transition for nav consistency */
        margin-bottom: 20px;
        overflow: hidden;
      }

      .chapter-card:hover {
        /* Removed transform for consistency */
        box-shadow: 0 10px 25px rgba(0,0,0,.15);
      }

      .chapter-card .card-body {
        padding: 25px;
      }

      .chapter-card .card-title {
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 15px;
      }

      .chapter-card .card-text {
        color: #6c757d;
        line-height: 1.6;
      }

      .chapter-card .btn {
        border-radius: 25px;
        padding: 8px 20px;
        font-weight: 500;
        /* Removed transition for consistency */
      }
      .nav-buttons {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .nav-button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,.2);

        /* Removed transition for consistency */
        display: flex;
        align-items: center;
        justify-content: center;
      }
     .nav-button:hover {
       /* Removed transform for consistency */
       box-shadow: 0 6px 20px rgba(0,0,0,.3);
     }

      /* Mermaid Diagram Styles */
      .mermaid {
        position: relative;
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,.1);
        overflow: hidden;
      }

      .mermaid svg {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        cursor: grab;
        transition: transform 0.3s ease;
      }

      .mermaid svg.dragging {
        cursor: grabbing;
      }

      /* Zoom Controls Overlay */
      .mermaid-zoom-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        opacity: 1;
        transition: opacity 0.3s ease;
        z-index: 10;
      }

      .mermaid-zoom-btn {
        width: 30px;
        height: 30px;
        border: none;
        border-radius: 50%;
        background: rgba(102, 126, 234, 0.9);
        color: white;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0,0,0,.2);
        transition: all 0.2s ease;
      }

      .mermaid-zoom-btn:hover {
        background: rgba(102, 126, 234, 1);
        transform: scale(1.1);
      }

      .mermaid-zoom-btn:active {
        transform: scale(0.95);
      }

      .chapter-nav {
        padding: 20px 0;
        margin-top: 40px;
        text-align: center;
        margin-left: 330px; /* Match sidebar width to align with main content */
        width: calc(100% - 330px); /* Account for sidebar width */
      }
      
      @media (max-width: 768px) {

     .chapter-nav .btn {
       border-radius: 25px;
       padding: 10px 25px;
       font-weight: 500;
       /* Removed transform for consistency */
     }

     .chapter-nav .btn:hover {
       /* Removed transform for consistency */
       box-shadow: 0 4px 15px rgba(0,0,0,.2);
     }

     code {
       background-color: #e9ecef;
       padding: 2px 6px;
       border-radius: 4px;
       color: #495057;
     }

     pre {
       background-color: #2d3748;
       color: #e2e8f0;
       padding: 20px;
       border-radius: 10px;
       overflow-x: auto;
       box-shadow: 0 4px 6px rgba(0,0,0,.1);
     }

      blockquote {
        border-left: 5px solid #667eea;
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        padding: 20px 25px;
        margin: 25px 0;
        border-radius: 0 15px 15px 0;
        box-shadow: 0 3px 10px rgba(0,0,0,.05);
        font-style: italic;
        position: relative;
      }

      blockquote::before {
        content: '"';
        font-size: 4rem;
        color: #667eea;
        opacity: 0.3;
        position: absolute;
        top: -10px;
        left: 15px;
        font-family: serif;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
      }

      .chapter-card {
        animation: fadeInUp 0.6s ease-out;
        animation-fill-mode: both;
      }

      .chapter-card:nth-child(1) { animation-delay: 0.1s; }
      .chapter-card:nth-child(2) { animation-delay: 0.2s; }
      .chapter-card:nth-child(3) { animation-delay: 0.3s; }
      
      /* Center chapter navigation and footer within main content area */
      .chapter-nav {
        background: transparent;
        padding: 20px 0;
        margin-top: 40px;
        text-align: center;
        margin-left: 330px; /* Match sidebar width to align with main content */
        width: calc(100% - 330px); /* Account for sidebar width */
        position: relative; /* Ensure proper positioning */
      }
      
      footer {
        margin-left: 330px; /* Match sidebar width to align with main content */
        width: calc(100% - 330px); /* Account for sidebar width */
        position: relative; /* Ensure proper positioning */
      }
      
      @media (max-width: 768px) {
        .chapter-nav, footer {
          margin-left: 0 !important;
          width: 100% !important;
        }
      }
   </style>
</head>
<body>
    <!-- Sticky Header -->
    <header class="sticky-header">
       <nav class="navbar navbar-expand-lg navbar-light">
         <div class="d-flex justify-content-between align-items-center">
           <a href="index.html" class="btn btn-link text-white me-3" title="Home">
             <i class="bi bi-house-door fs-4"></i>
           </a>
           <div class="mx-auto">
             <span class="navbar-brand"> Refreshrestorepoints    Function  Implied  - RestorePointsManager</span>
           </div>
           <div></div> <!-- Spacer -->
         </div>
       </nav>
    </header>

    <!-- Sidebar -->
    <div class="sidebar">
      <nav class="nav flex-column">
        <li class="nav-item">
          <a href="index.html" class="nav-link">
            <i class="bi bi-house-door"></i>Home
          </a>
        </li>
        <li class="nav-item"><a href="01_restore_point.html" class="nav-link">Restore Point</a></li>
<li class="nav-item"><a href="02_gui__graphical_user_interface_.html" class="nav-link">Gui  Graphical User Interface </a></li>
<li class="nav-item"><a href="03_admin_privileges.html" class="nav-link">Admin Privileges</a></li>
<li class="nav-item"><a href="04__creategui____function.html" class="nav-link"> Creategui    Function</a></li>
<li class="nav-item"><a href="05__refreshrestorepoints____function__implied_.html" class="nav-link"> Refreshrestorepoints    Function  Implied </a></li>
<li class="nav-item"><a href="06__checkadmin____function.html" class="nav-link"> Checkadmin    Function</a></li>
<li class="nav-item"><a href="07_logging.html" class="nav-link">Logging</a></li>
<li class="nav-item"><a href="08_global_variables.html" class="nav-link">Global Variables</a></li>
      </nav>
    </div>

    <div class="main-content">
      <div class="container mt-4">
        
        <h1>Chapter 5: <code>RefreshRestorePoints()</code> Function (Implied)</h1>
<p>In the previous chapter, <a href="04__creategui____function.html"><code>CreateGUI()</code> Function</a>, we learned how the program creates the buttons and lists you see on the screen. But what good is a list if it&#39;s empty? That&#39;s where the <code>RefreshRestorePoints()</code> function comes in!</p>
<p>Imagine you just moved into a new house. You have all the rooms set up, but they&#39;re empty. You need to go out and buy furniture to fill them! The <code>RefreshRestorePoints()</code> function is like going out and getting the furniture (the list of restore points) to fill the ListView in our program&#39;s &quot;house.&quot;</p>
<h2>What is the <code>RefreshRestorePoints()</code> Function (Implied)?</h2>
<p>Although we don&#39;t see a <code>RefreshRestorePoints()</code> function explicitly defined in a separate block of code, it&#39;s <em>implied</em> by its use in the <code>Main Execution</code> section and within the <code>CreateGUI()</code> function when the &quot;Refresh&quot; button is clicked. This function is responsible for:</p>
<ol>
<li><strong>Fetching the list of restore points:</strong> It asks Windows for the current list of restore points on your computer.</li>
<li><strong>Displaying the list in the GUI:</strong> It takes the list of restore points and shows them in the ListView, so you can see them.</li>
<li><strong>Updating the labels:</strong> It updates the labels showing the number of restore points and the disk space they use.</li>
</ol>
<p>Think of it as taking a photograph of all the restore points on your computer and displaying that photograph in the program&#39;s window.</p>
<h2>Why Do We Need <code>RefreshRestorePoints()</code>?</h2>
<p>Let&#39;s say you create a new restore point using another program, or Windows itself. If you then open <code>RestorePointsManager</code>, the list might be outdated. You need a way to update the list to show the latest restore points. That&#39;s what <code>RefreshRestorePoints()</code> does!</p>
<p>It&#39;s like checking your email. You need to refresh your inbox to see if you have any new messages. <code>RefreshRestorePoints()</code> refreshes the list of restore points in the program.</p>
<h2>How to &quot;Use&quot; <code>RefreshRestorePoints()</code></h2>
<p>You don&#39;t directly <em>call</em> the <code>RefreshRestorePoints()</code> function yourself in the code. Instead, it&#39;s called in two main situations:</p>
<ol>
<li><strong>When the program starts:</strong> This ensures the list is populated when you first open the program.</li>
<li><strong>When you click the &quot;Refresh&quot; button:</strong> This allows you to manually update the list whenever you want.</li>
</ol>
<p>When you click the &quot;Refresh&quot; button, the ListView will clear, and then it will repopulate with the latest list of restore points from your system. The labels showing the count and disk space will also update.</p>
<h2>Key Steps Inside <code>RefreshRestorePoints()</code></h2>
<p>Here&#39;s a simplified breakdown of what <code>RefreshRestorePoints()</code> does:</p>
<ol>
<li><strong>Show a &quot;Loading&quot; message:</strong> This tells you that the program is working.</li>
<li><strong>Get the number of restore points:</strong> It asks Windows how many restore points there are.</li>
<li><strong>Get the disk space used by restore points:</strong> It asks Windows how much space the restore points are taking up.</li>
<li><strong>Update the labels:</strong> It updates the labels in the GUI to show the number of restore points and the disk space used.</li>
<li><strong>Clear the ListView:</strong> It removes all the old restore points from the list.</li>
<li><strong>Get the list of restore points from Windows:</strong> It asks Windows for the details of each restore point (ID, creation time, description).</li>
<li><strong>Add the restore points to the ListView:</strong> It adds each restore point to the list in the GUI.</li>
<li><strong>Hide the &quot;Loading&quot; message:</strong> This tells you that the program is finished.</li>
</ol>
<h2>Under the Hood: How <code>RefreshRestorePoints()</code> Works</h2>
<p>Let&#39;s take a look at what happens step-by-step when the <code>RefreshRestorePoints()</code> function is &quot;called&quot; (either on startup or by clicking the refresh button):</p>
<div class="mermaid">sequenceDiagram
    participant User
    participant RestorePointsManager
    participant Windows
    participant WMI

    alt User clicks &quot;Refresh&quot; button
        User->>RestorePointsManager: Click &quot;Refresh&quot;
    end
    RestorePointsManager->>RestorePointsManager: ShowProgress(&quot;Loading...&quot;)
    RestorePointsManager->>Windows: Get restore points count & storage info
    Windows-->>RestorePointsManager: Count & storage info
    RestorePointsManager->>RestorePointsManager: Update labels
    RestorePointsManager->>RestorePointsManager: Clear ListView
    RestorePointsManager->>WMI: Query restore points
    WMI-->>RestorePointsManager: Restore point data
    RestorePointsManager->>RestorePointsManager: Add restore points to ListView
    RestorePointsManager->>RestorePointsManager: HideProgress()
    RestorePointsManager->>RestorePointsManager: Update Delete button state
    RestorePointsManager->>RestorePointsManager: Update disk space info
    RestorePointsManager-->>User: Updated list of restore points</div>
<ol>
<li>The user clicks the &quot;Refresh&quot; button (or the program starts).</li>
<li>The <code>RestorePointsManager</code> shows a &quot;Loading&quot; message.</li>
<li>The <code>RestorePointsManager</code> asks Windows for the number of restore points and how much disk space they&#39;re using.</li>
<li>Windows provides the information.</li>
<li>The <code>RestorePointsManager</code> updates the labels in the GUI.</li>
<li>The <code>RestorePointsManager</code> clears the ListView.</li>
<li>The <code>RestorePointsManager</code> uses WMI (Windows Management Instrumentation) to query for the list of restore points.</li>
<li>WMI provides the list of restore points.</li>
<li>The <code>RestorePointsManager</code> adds each restore point to the ListView.</li>
<li>The <code>RestorePointsManager</code> hides the &quot;Loading&quot; message.</li>
<li>The <code>RestorePointsManager</code> updates the state of the Delete button based on whether an item is selected.</li>
<li>The <code>RestorePointsManager</code> updates the disk space info.</li>
<li>The user sees the updated list of restore points.</li>
</ol>
<h2>Code Deep Dive</h2>
<p>Let&#39;s look at some code snippets from the <code>RefreshRestorePoints()</code> function in <code>RestorePointsManager.ahk</code>:</p>
<pre><code class="language-autohotkey">RefreshRestorePoints() {
    LogDebug(&quot;Refreshing restore points&quot;)
    ShowProgress(&quot;Loading restore points...&quot;)
    ; ... (rest of the function)
}
</code></pre>
<p>This is the start of the <code>RefreshRestorePoints()</code> function. It first logs a debug message and then calls the <code>ShowProgress()</code> function to display a &quot;Loading&quot; message.</p>
<pre><code class="language-autohotkey">count := GetRestorePointsCount()
storageInfo := GetRestorePointsStorageInfo()

lblRestorePointsCount.Text := &quot;Restore Points: &quot; count
if (storageInfo != &quot;&quot;) {
    lblDiskSpaceUsed.Text := &quot;Disk Space Used: &quot; storageInfo
} else {
    lblDiskSpaceUsed.Text := &quot;Disk Space Used: Unknown&quot;
}
</code></pre>
<p>This code gets the number of restore points and the disk space used, and then updates the labels in the GUI.</p>
<pre><code class="language-autohotkey">lvRestorePoints.Delete()
</code></pre>
<p>This line clears the ListView, removing all the old restore points from the list.</p>
<pre><code class="language-autohotkey">wmi := ComObject(&quot;WbemScripting.SWbemLocator&quot;)
service := wmi.ConnectServer(&quot;.&quot;, &quot;root\default&quot;)
service.Security_.ImpersonationLevel := 3
colItems := service.ExecQuery(&quot;SELECT * FROM SystemRestore&quot;)

for item in colItems {
    lvRestorePoints.Add(, item.SequenceNumber, FormatTime(item.CreationTime), item.Description)
}
</code></pre>
<p>This code uses WMI to query for the list of restore points and then adds each restore point to the ListView. The <code>FormatTime()</code> function (defined elsewhere in the script) converts the WMI time format to a readable format.</p>
<h2>Conclusion</h2>
<p>In this chapter, we learned about the <code>RefreshRestorePoints()</code> function (implied) and how it fetches the list of restore points from Windows and displays them in the GUI. We saw how it updates the labels and clears the ListView before adding the new restore points.</p>
<p>In the next chapter, we&#39;ll explore the <a href="06__checkadmin____function.html"><code>CheckAdmin()</code> Function</a> in more detail and see how it ensures that the program has the necessary admin privileges to work correctly.</p>


      </div>
    </div>

   <!-- Navigation Buttons -->
   <div class="nav-buttons">
     <button class="nav-button" onclick="scrollToTop()">↑</button>
     <button class="nav-button" onclick="scrollToBottom()">↓</button>
   </div>

    <!-- Chapter Navigation -->
    <div class="chapter-nav text-center mt-5 mb-5">
       
         <a href="04__creategui____function.html" class="btn btn-secondary mx-2">← Previous</a>
         <a href="06__checkadmin____function.html" class="btn btn-primary mx-2">Next →</a>
       
    </div>

   <!-- Footer -->
   <footer class="text-center mt-5 py-4" style="border-top: 1px solid #e9ecef; background: #fff; margin-left: 330px; width: calc(100% - 330px); position: relative;">
     <div class="container">
       <p class="mb-0 text-muted">
         <small>Generated by <a href="https://github.com/sarfraznawaz2005/code2tut" class="text-decoration-none" style="color: #667eea; font-weight: 500;">Code2Tutorial</a></small>
       </p>
     </div>
   </footer>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Prism.js for syntax highlighting -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
   <script>
     // Initialize Mermaid
     mermaid.initialize({ startOnLoad: true });

     // Initialize syntax highlighting, but skip mermaid elements
     document.querySelectorAll('pre code').forEach((block) => {
       if (!block.closest('.mermaid')) {
         Prism.highlightElement(block);
       }
     });

     // Highlight current chapter in sidebar
     document.addEventListener('DOMContentLoaded', function() {
       const currentPage = window.location.pathname.split('/').pop();
       const navLinks = document.querySelectorAll('.sidebar .nav-link');
       navLinks.forEach(link => {
         if (link.getAttribute('href') === currentPage) {
           link.classList.add('active');
         }
       });
     });

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowUp') {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else if (e.key === 'ArrowDown') {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }
    });

    // Scroll functions for buttons
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function scrollToBottom() {
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // Mermaid zoom and pan functionality
    const ZOOM_STEP = 0.2;
    const MIN_ZOOM = 0.5;
    const MAX_ZOOM = 3;

    // Initialize zoom controls for each mermaid diagram
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for Mermaid to finish rendering
      setTimeout(() => {
        const mermaidContainers = document.querySelectorAll('.mermaid');
        mermaidContainers.forEach(container => {
          initMermaidControls(container);
        });
      }, 1000); // Wait 1 second for Mermaid to render
    });

    function initMermaidControls(container) {
      const svg = container.querySelector('svg');
      if (!svg) return;

      // Add zoom controls overlay
      const controls = document.createElement('div');
      controls.className = 'mermaid-zoom-controls';
      controls.innerHTML = '<button class="mermaid-zoom-btn" onclick="zoomInMermaid(this)" title="Zoom In">+</button><button class="mermaid-zoom-btn" onclick="zoomOutMermaid(this)" title="Zoom Out">-</button><button class="mermaid-zoom-btn" onclick="resetMermaidZoom(this)" title="Reset Zoom">⭯</button>';
      container.appendChild(controls);

      // Initialize zoom and pan state
      svg.dataset.zoom = '1';
      svg.dataset.panX = '0';
      svg.dataset.panY = '0';
      svg.dataset.dragging = 'false';

      // Add pan functionality
      let isDragging = false;
      let startX, startY, startPanX, startPanY;

      svg.addEventListener('mousedown', function(e) {
        if (parseFloat(svg.dataset.zoom) > 1) {
          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;
          startPanX = parseFloat(svg.dataset.panX);
          startPanY = parseFloat(svg.dataset.panY);
          svg.classList.add('dragging');
          svg.dataset.dragging = 'true';
          e.preventDefault();
        }
      });

      document.addEventListener('mousemove', function(e) {
        if (isDragging && svg.dataset.dragging === 'true') {
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;
          const newPanX = startPanX + deltaX;
          const newPanY = startPanY + deltaY;

          svg.dataset.panX = newPanX;
          svg.dataset.panY = newPanY;
          updateMermaidTransform(svg);
        }
      });

      document.addEventListener('mouseup', function() {
        if (isDragging) {
          isDragging = false;
          svg.classList.remove('dragging');
          svg.dataset.dragging = 'false';
        }
      });

      // Prevent context menu on right click for better UX
      svg.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });
    }

    function zoomInMermaid(button) {
      const container = button.closest('.mermaid');
      const svg = container.querySelector('svg');
      let zoom = parseFloat(svg.dataset.zoom);
      zoom = Math.min(zoom + ZOOM_STEP, MAX_ZOOM);
      svg.dataset.zoom = zoom;
      updateMermaidTransform(svg);
      container.classList.add('zoomed');
    }

    function zoomOutMermaid(button) {
      const container = button.closest('.mermaid');
      const svg = container.querySelector('svg');
      let zoom = parseFloat(svg.dataset.zoom);
      zoom = Math.max(zoom - ZOOM_STEP, MIN_ZOOM);
      svg.dataset.zoom = zoom;
      updateMermaidTransform(svg);
      if (zoom <= 1) {
        container.classList.remove('zoomed');
      }
    }

    function resetMermaidZoom(button) {
      const container = button.closest('.mermaid');
      const svg = container.querySelector('svg');
      svg.dataset.zoom = '1';
      svg.dataset.panX = '0';
      svg.dataset.panY = '0';
      updateMermaidTransform(svg);
      container.classList.remove('zoomed');
    }

    function updateMermaidTransform(svg) {
      const zoom = parseFloat(svg.dataset.zoom);
      const panX = parseFloat(svg.dataset.panX);
      const panY = parseFloat(svg.dataset.panY);

      svg.style.transform = 'translate(' + panX + 'px, ' + panY + 'px) scale(' + zoom + ')';
      svg.style.transformOrigin = 'center center';
    }


  </script>
</body>
</html>
